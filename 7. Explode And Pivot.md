# PySpark Explode and Pivot

---

# Explode in PySpark

## What is Explode?

**explode** is a PySpark function used when a column contains **multiple values inside a single cell** (like a **list** or **array**).

It **breaks that single row into multiple rows** — one row for each value.

**In simple words:**

**explode = "One row → Many rows"**

---

## Why do we need Explode?

Sometimes data is stored like this:

| ID | Subjects                 |
| -- | ------------------------ |
| 1  | [Math, Science, English] |

But for analysis, we want:

| ID | Subject |
| -- | ------- |
| 1  | Math    |
| 1  | Science |
| 1  | English |

So we use **explode**.

---

## Real Life Example

Suppose:

One student studies **3 subjects**.

Instead of storing 3 rows, data is stored in one row as a list.

To analyze each subject separately → we use **explode**.

---

## Basic Syntax

```python
from pyspark.sql.functions import explode

df.withColumn("new_column", explode("old_column"))
```

### Meaning

* Takes list/array column
* Creates multiple rows
* Each row contains one value

---

## Example 1 — With Array Column

### Data

| Name | Skills               |
| ---- | -------------------- |
| A    | [Python, SQL, Excel] |

### Code

```python
from pyspark.sql.functions import explode

df.withColumn("Skill", explode("Skills")).display()
```

### Output

| Name | Skill  |
| ---- | ------ |
| A    | Python |
| A    | SQL    |
| A    | Excel  |

---

## Important Point

**Original row is duplicated**
Only array values change.

---

## Example 2 — With Multiple Rows

### Data

| Name | Skills        |
| ---- | ------------- |
| A    | [Python, SQL] |
| B    | [Excel]       |

### After Explode

| Name | Skill  |
| ---- | ------ |
| A    | Python |
| A    | SQL    |
| B    | Excel  |

---

## Explode vs Split

**split**

* Converts **string → array**

**explode**

* Converts **array → multiple rows**

### Combined Use

```python
from pyspark.sql.functions import split, explode

df.withColumn("Skill", explode(split("Skills", ",")))
```

### Flow

```
"Python,SQL,Excel"
        ↓ split
["Python","SQL","Excel"]
        ↓ explode
3 rows
```

---

## When Explode is Commonly Used

Very important in:

* JSON data
* Nested data
* Arrays
* Lists
* Tags column
* Multiple categories in one column

### Examples

* E-commerce product tags
* User interests
* Movie genres

---

## One Line Interview Answer

**explode converts each element of an array or list column into a separate row.**

---

# Pivot in PySpark

---

## What is Pivot?

**Pivot** is used to **convert row values into columns**.

**In simple words:**

**Pivot = "Rows → Columns"**

It is mainly used for **data summarization**.

---

## Why do we use Pivot?

Suppose data is stored like this:

| Name | Subject | Marks |
| ---- | ------- | ----- |
| A    | Math    | 90    |
| A    | English | 80    |
| B    | Math    | 70    |
| B    | English | 85    |

But we want:

| Name | Math | English |
| ---- | ---- | ------- |
| A    | 90   | 80      |
| B    | 70   | 85      |

So we use **pivot**.

---

## Basic Syntax

```python
df.groupBy("column1").pivot("column2").agg(function)
```

### Meaning

* **groupBy** → rows remain
* **pivot** → column values become new columns
* **agg** → aggregation (sum, avg, count etc.)

**Pivot always needs aggregation.**

---

## Example

### Data

| Name | Subject | Marks |

### Code

```python
df.groupBy("Name").pivot("Subject").sum("Marks").display()
```

### Output

| Name | English | Math |
| ---- | ------- | ---- |
| A    | 80      | 90   |
| B    | 85      | 70   |

---

## Step-by-Step Understanding

### Step 1 — Group

```
groupBy("Name")
```

Rows will be based on **Name**

---

### Step 2 — Pivot

```
pivot("Subject")
```

Subjects become columns:

* Math
* English

---

### Step 3 — Aggregate

```
sum("Marks")
```

Values fill inside columns.

---

## Real Life Use Cases

Very common in:

* Sales reports
* Monthly revenue
* Department performance
* Attendance reports
* Dashboard tables

### Example

| Employee | Month | Sales |

Pivot → Month becomes columns.

---

## Important Points (Interview Focus)

### 1. Pivot needs aggregation

Without aggregation → error.

---

### 2. Reverse of Pivot = Unpivot

Unpivot is done using:

* **stack**
* **melt (pandas)**
* **selectExpr**

---

### 3. Pivot creates wide table

* More columns
* Fewer rows

---

## Small Comparison

| Operation | Converts            |
| --------- | ------------------- |
| explode   | One row → many rows |
| pivot     | Rows → columns      |
| groupBy   | Aggregates data     |

---

## One Line Interview Answer

**Pivot converts unique values of one column into multiple columns using aggregation.**

---
